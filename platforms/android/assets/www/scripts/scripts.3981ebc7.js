"use strict";angular.module("reforguiApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngDialog","ngTouch","ngStorage"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when("/matches/",{templateUrl:"views/matches.html",controller:"MatchesCtrl"}).when("/profile",{templateUrl:"views/profile.html",controller:"ProfileCtrl",controllerAs:"profile"}).otherwise({redirectTo:"/"})}]);var CordovaInit=function(){var a=function(){b("deviceready")},b=function(){console.log("Start event received, bootstrapping application setup."),angular.bootstrap($("body"),["reforguiApp"])};this.bindEvents=function(){document.addEventListener("deviceready",a,!1)},void 0!==window.cordova?(console.log("Cordova found, wating for device."),this.bindEvents()):(console.log("Cordova not found, booting application"),b("manual"))};$(function(){console.log("Bootstrapping!"),new CordovaInit}),angular.module("reforguiApp").controller("MainCtrl",["$scope","$location","$localStorage","getdataws",function(a,b,c,d){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.init=function(){null!=c.userId?(a.user=c.userId,d.retrieveReferee(c.userId).success(function(b){0!=b.length&&1==b.length&&(a.user=b[0])}),console.log("sei qui!",c.userId)):(console.log("sei qui!",c.userId),b.path("/register"))},a.goBack=function(){window.history.back()},a.init()}]),angular.module("reforguiApp").controller("AboutCtrl",["$scope","$rootScope","$timeout","getdataws",function(a,b,c,d){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.coords=[],a.readyToSend=!1,a.checkDate=function(a){var b=Date.now(),c=Date.parse(a);return b>c?!0:!1},a.display=function(){a.toEdit=!1,a.match=b.match,a.readyToSend=!a.match.isSent,c(function(){var b=a.match.address,c=new google.maps.LatLng(-34.397,150.644),d=new google.maps.Geocoder,e={zoom:15,center:c,mapTypeId:google.maps.MapTypeId.ROADMAP};a.map=new google.maps.Map(document.getElementById("map"),e),d&&d.geocode({address:b},function(c,d){if(d==google.maps.GeocoderStatus.OK)if(d!=google.maps.GeocoderStatus.ZERO_RESULTS){a.map.setCenter(c[0].geometry.location),a.coords=[c[0].geometry.location.lat(),c[0].geometry.location.lng()],console.log("coordinate rilevate:",a.coords);var e=new google.maps.InfoWindow({content:"<b>"+b+"</b>",size:new google.maps.Size(150,50)}),f=new google.maps.Marker({position:c[0].geometry.location,map:a.map,title:b});google.maps.event.addListener(f,"click",function(){e.open(map,f)})}else alert("No results found");else alert("Geocode was not successful for the following reason: "+d)})},200)},a.edit=function(){a.toEdit=!0,a.copymatch=angular.copy(a.match)},a.update=function(){console.log(a.match),d.updateMatch(a.copymatch).success(function(b){a.readyToSend=!0,a.toEdit=!1,a.match=a.copymatch}).error(function(a,b){alert("ci sono stati problemi con il server, riprovare più tardi")})},a.navigate=function(){launchnavigator.navigate(a.coords,null,function(){},function(a){alert("Plugin error:"+a)})},a.display()}]),angular.module("reforguiApp").controller("RegisterCtrl",["$scope","$location","$localStorage","getdataws",function(a,b,c,d){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.user={id_ref:null,name:null,surname:null,fullname:null,address:null,mail:null,id:null},a.temp={city:null,state:null},a.registerRef=function(){a.user.fullname=a.user.surname+" "+a.user.name,a.user.address=a.user.address+" - "+a.temp.city+" ("+a.temp.state+")",console.log("oggetto creato dopo la compilazione del form",a.user),d.retrieveReferee(a.user.id_ref).success(function(b){0!=b.length&&1==b.length?(a.user=b[0],console.log("esiste già",a.user)):d.createReferee(a.user).success(function(a){}).error(function(a,b){alert("ci sono stati problemi con il server, riprovare più tardi")})}),c.userId=a.user.id_ref,b.path("/")}}]),angular.module("reforguiApp").factory("getdataws",["$http",function(a){var b="http://www.elmariachistudios.it/reforg/",c=42;return{someMethod:function(){return c},retrieveReferee:function(c){return a.get(b+"referee?id="+c)},createReferee:function(c){return a.put(b+"referee/create",c)},retrieveMatches:function(c,d,e,f){return e?a.get(b+"match/todos?name="+c+"&surname="+d+"&start="+e+"&end="+f):a.get(b+"match?name="+c+"&surname="+d)},updateMatch:function(c){return a.put(b+"match/update",c)}}}]),angular.module("reforguiApp").controller("MatchesCtrl",["$scope","$rootScope","$timeout","$location","$localStorage","$filter","getdataws","utils",function(a,b,c,d,e,f,g,h){a.user,a.active=1,a.init=function(){-1==b.active?a.active=1:a.active=b.active,g.retrieveReferee(e.userId).success(function(b){switch(0!=b.length&&1==b.length&&(a.user=b[0]),a.active){case 0:a.showDone();break;case 1:a.showToday();break;case 2:a.showFuture();break;default:a.showToday()}})},a.stripDate=function(a){return a=h.getDate(a)},a.stripTime=function(a){return a=h.getTime(a)},a.showInfo=function(c){b.active=a.active,b.match=c,d.path("/about")},a.showDone=function(){a.active=0,b.active=a.active,g.retrieveMatches(a.user.name,a.user.surname).success(function(b){a.refMatches=b,c(function(){},1e3)}).error(function(a,b){alert("ci sono stati problemi con il server, riprovare più tardi")})},a.showToday=function(){a.active=1,b.active=a.active;var d=new Date;d.setHours(0,0,0,0),a.date=f("date")(d,"yyyy-MM-dd HH:mm"),g.retrieveMatches(a.user.name,a.user.surname,a.date).success(function(b){a.refMatches=b,c(function(){},1e3)}).error(function(a,b){alert("ci sono stati problemi con il server, riprovare più tardi")})},a.showFuture=function(){a.active=2,b.active=a.active;var d=new Date;d.setHours(0,0,0,0),a.start=f("date")(d,"yyyy-MM-dd HH:mm");var e=new Date;e.setHours(0,0,0,0),e.setDate(e.getDate()+30),a.end=f("date")(e,"yyyy-MM-dd HH:mm"),g.retrieveMatches(a.user.name,a.user.surname,a.start,a.end).success(function(b){a.refMatches=b,c(function(){},1e3)}).error(function(a,b){alert("ci sono stati problemi con il server, riprovare più tardi")})},a.swipeRight=function(){if(a.active>0)switch(a.active--,a.active){case 0:a.showDone();break;case 1:a.showToday();break;case 2:a.showFuture()}},a.swipeLeft=function(){if(a.active<2)switch(a.active++,a.active){case 0:a.showDone();break;case 1:a.showToday();break;case 2:a.showFuture()}},a.init()}]),angular.module("reforguiApp").factory("utils",function(){var a=42;return{someMethod:function(){return a},getDate:function(a){if(null!=a&&a){var b=a.split("T"),c=b[0];b=c.split("-"),a=b[2]+"/"+b[1]+"/"+b[0]}return a},getTime:function(a){if(null!=a&&a){var b=a.split("T");a=b[1]}if(null!=a){var c=a.split(":");a=c[0]+":"+c[1]}return a}}}),angular.module("reforguiApp").controller("ProfileCtrl",["$scope","$location","$localStorage","getdataws",function(a,b,c,d){function e(){a.toEdit=!1,a.editableAddresses=!1,a.editableContacts=!1}a.edit=function(b){a.toEdit=!0,a.editedUser=angular.copy(a.user),"addresses"===b&&(a.editableAddresses=!0),"contacts"===b&&(a.editableContacts=!0)},a.close=function(){e()},a.update=function(){a.user=angular.copy(a.editedUser),e()},a.init=function(){null!=c.userId?(a.user=c.userId,d.retrieveReferee(c.userId).success(function(b){0!=b.length&&1==b.length&&(a.user=b[0])}),console.log("sei qui!",c.userId)):(console.log("sei qui!",c.userId),b.path("/register")),e()},a.init()}]);